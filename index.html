<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

	<head>
		<meta charset="utf-8">

		<title>INTROBAY - Docker & Drupal</title>

		<meta name="description" content="Docker & Drupal">
		<meta name="author" content="Ignacio López Flores - Javier Gómez Gómez">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/introbay.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>



		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>
		<style type="text/css">
            .reveal section img.sin-cajas {
                border:none; 
                width:85px ;
                background: none;
                box-shadow: none;
            }
        </style>

        <!-- Slides  content to be added here -->

        <div class="reveal">
            <div class="slides">

                <section>
                    <img src="imgs/logo-tag-centro-blanco.svg" style="width: 30%;box-shadow: none;border: none;">
                    <img src="imgs/logodevops.png" style="width: 34%;box-shadow: none;border: none;margin-left: 10%">
                    <div>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</div>
                    <br>
                    <div style="float: left; margin-bottom: 20px;">
                        <img src="imgs/Logo-Docker.svg" style="width: 44%;box-shadow: none;border: none;float: left">
                        <span class="ampersand">&</span>
                        <img src="imgs/drupal_logo-blue.png" style="width: 30%;box-shadow: none;border: none;float: left">
                    </div>
                    <h3>Una imagen vale más que mil palabras</h3>
                </section>
                <section>
                    <h2>Sobre mi</h2>
                    <img align="left" src="imgs/sobre-nosotros/ignacio.png" width="250" style=" border: none; box-shadow: none; ">
                    <div style="float: right;" class="ficha">
                      <p>Ignacio L&oacute;pez Flores</p>
                      <p>Founder & CEO @ Introbay</p>
                      <a href="https://twitter.com/ignaciolflores" target="_blank">@ignaciolflores</a>
                      <p>IRC: ignaciolflores</p>
                    </div>
                  </section>
                <section>
                    <section>
                        <h2>La matriz del infierno</h2>
                        <img class="sin-cajas" style="width:800px" src="imgs/also-a-matrix-from-hell.png">
                    </section>
                    <section>
                        <h2>La matriz del infierno</h2>
                        <img class="sin-cajas" style="width:800px" src="imgs/the-matrix-from-hell.png">
                    </section>
                    <section>
                        <h2>La solución de Docker</h2>
                        <img class="sin-cajas" style="width:900px" src="imgs/Screen_Shot_2014-10-27_at_11.24.59_PM.png">
                    </section>

                    <section>
                        <h2>Linux Containers (LCX)</h2>
                        <!--<img class="sin-cajas" style="width:600px" src="imgs/Linux-containers.jpg">-->
                        <ul>
                            <li>Permite que un servidor físico ejecute <span class="resaltado">múltiples instancias</span> de sistemas operativos aislados compartiendo el kernel.</li>
                            <li>Pueden tener diferentes Sistemas Operativos (debian, centos, redhat, ubuntu, etc.) siempre que tengan la <span class="resaltado">misma versión del kernel</span> que el sistema anfitrión.</li>
                            <li>Consumen <span class="resaltado">menos recursos</span> hardware y software que las VM.</li>
                            <li>Implementación basada en <span class="resaltado">imágenes</span>.</li>
                            <li><span class="resaltado">Aislamiento de aplicaciones</span> que se pueden combinar.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Y llegó Docker</h2>
                        <ul>
                            <li>LCX <span class="resaltado">independiza</span> sistemas operativos ligeros sobre los que lanzar aplicaciones.</li>
                            <li>Docker define un formato para <span class="resaltado">empaquetar una aplicación</span> y todas sus <span class="resaltado">dependencias</span> en un solo objeto que pueden ser transferidas a cualquier otro sistema Docker, y ser ejecutados allí con la garantía de que el entorno de ejecución será <span class="resaltado">siempre el mismo.</span></li>
                            <li><strong>Contenedores:</strong> contienen todo lo necesario para que una aplicación pueda funcionar.</li>
                            <li><strong>Imágenes:</strong> sistema operativo con aplicaciones instaladas y configuradas.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Estructura de Docker</h2>
                        <img class="sin-cajas" style="width:800px" src="imgs/docker_engine_overview_image_0.png">
                    </section>

                    <section>
                        <h2>Docker Registry</h2>
                        <ul>
                            <li><span class="resaltado">Registry: </span>Servidor que contiene repositorios e imágenes.</li>
                            <li><span class="resaltado">Repositorios: </span>Contiene imagenes creadas y listas para ser descargadas.</li>
                            <li>Repositorio oficial <span class="resaltado">
                                <a target="_blank" href="https://hub.docker.com/">https://hub.docker.com</a>
                            <li>En <span class="resaltado">Dockerhub</span> podemos crear repositorios privados ó públicos.</li>
                            <li>Dockerhub se integra con repositorios de código como <span class="resaltado">GitHub</span> y construye las imagenes al actualizarlos.</li>
                            <li>También podemos tener nuestro propio Registry que se crea a partir de una imagen Docker.</li>
                        </ul>
                        <!--<img class="sin-cajas" style="width:600px" src="imgs/docker-structure.jpg">-->
                    </section>
                </section>

                <section>
                    <h2>Requisitos de Docker</h2>
                    <ul>
                        <li>Docker necesita que el host sea linux 64bits y que el core sea como mínimo v3.10, se recomienda ubuntu o debian aunque puede ser cualquier distro.</li>
                    </ul>
                </section>

               

                <section>
                    <h2>Instalación  en servicios cloud</h2>

                    <img class="sin-cajas" style="width:200px" src="imgs/logo-amazon.png">
                    <img class="sin-cajas" style="width:200px" src="imgs/logo-azure.png">
                    <img class="sin-cajas" style="width:200px" src="imgs/logo-google-cloud.png">
                    <img class="sin-cajas" style="width:200px" src="imgs/logo-IBM-sotflayer.png">
                    <img class="sin-cajas" style="width:200px" src="imgs/logo-rackspace.png">
                    <br/>
                    <a target="_blank" href="https://docs.docker.com/engine/installation/cloud/">docs.docker.com/engine/installation/cloud</a>
                    <a target="_blank" href="https://docs.docker.com/machine/drivers/">docs.docker.com/machine/drivers</a>
                </section>

                <section>
                    <h2>Cómo funciona?</h2>

                    <ul>
                        <li>Descargamos una imagen base de un repositorio. <br/>
                            <span class="resaltado">docker pull</span></li>
                        <li>A partir de la imagen base creamos nuestro contenedor. <br/>
                            <span class="resaltado">docker run</span></li>
                        <li>Realizamos los cambios que deseamos sobre el contenedor.</li>
                        <li>Creamos nuestra imagen personalizada<br/>
                            <span class="resaltado">docker commit</span></li>
                        <li>Subimos la imagen a un repositorio (público ó privado).  <br/>
                            <span class="resaltado">docker push</span></li>
                        <li>Reutilizamos nuestra imagen docker como base para nuevos contenedores.</li>
                    </ul>

                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Demo 1

                        ```
                        $ docker pull drupal:7
                        $ docker run -d --name test drupal:7
                        ```
                        Entramos en el contenedor
                        ```
                        docker exec -it test bash
                        ```
                        Una vez dentro, instalamos drush
                        ```
                        curl -sS https://getcomposer.org/installer | php
                        mv composer.phar /usr/local/bin/composer

                        composer global require drush/drush:7.*

                        export PATH="$HOME/.composer/vendor/bin:$PATH"

                        echo export PATH=\"$HOME/.composer/vendor/bin:$PATH\" >> /root/.bashrc
                        ```
                    </script>
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Demo 1

                        Paramos el contenedor y lo añadimos a nuestro repositorio local

                        ```
                        docker stop test
                        docker commit test test-drupal:7
                        ```
                        Lanzamos MySQL
                        ```
                        docker run -d --name db-test \
                        -e MYSQL_ROOT_PASSWORD="1234" \
                        -e MYSQL_DATABASE="database" \
                        -e MYSQL_USER="user" \
                        -e MYSQL_PASSWORD="1234" mysql
                        ```
                        Lanzamos nuestra imagen linkada a la base de datos
                        ```
                        docker run -d --name nuevo-test --link db-test:db-server -p 8080:80 test-drupal:7
                        ```


                    </script>
                </section>

<!--
                <section data-background-video="video/demo1.mov">
                </section>
                -->
                                
                <section>
                    <h2>Video</h2>
                    <a href="https://www.youtube.com/watch?v=wxMb-QpKiG8">Ver el video.</a>
                </section>

                <section>
                    <h2>Docker-compose</h2>

                    <span class="resaltado">Constructor de aplicaciones multi-contenedor</span><br/>
                    <strong>Qué necesitamos:</strong><br/>

                    <ul>
                        <li>Carpeta del proyecto.</li>
                        <li>fichero <span class="resaltado">docker-compose.yml</span>.</li>
                        <li>levantar todo: <span class="resaltado">docker compose up</span></li>
                    </ul>
                    <p>
                        <strong>qué contiene <span class="resaltado">docker-compose.yml</span>?</strong>
                    </p>
                    <ul>
                        <li>descriptor de los contenedores.</li>
                        <li>formato de serialización <span class="resaltado">yaml</span>.</li>
                        <li>especificamos: contenedores, propiedades, variables de entorno, etc</li>
                    </ul>

                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Demo 2

                        `docker-compose.yml`

                        ```
                        web:
                          image: test-drupal:7
                          links:
                            - db:db-server
                          ports:
                            - 8080:80
                        db:
                          image: mysql:5.6
                          environment:
                            - MYSQL_ROOT_PASSWORD=1234
                            - MYSQL_DATABASE=database
                            - MYSQL_USER=user
                            - MYSQL_PASSWORD=1234
                        ```
                    </script>
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Demo 2

                        Creamos los contenedores

                        ```
                        $ docker-compose up -d
                        ```
                        Comprobamos que todo está en ejecución
                        ```
                        $ docker-compose ps

                        $ docker ps -a
                        ```
                    </script>
                </section>

                <!--<section data-background-video="video/demo2.mov">
                </section>-->

                <section>
                    <h2>Video</h2>
                    <a href="https://www.youtube.com/watch?v=grBz3rQhoqw">Ver el video.</a>
                </section>

                <section>
                    <h2>Dockerfile</h2>

                    <span><span class="resaltado">Docker build</span> Construye un contenedor a partir de un Dockerfile.</span><br/>
                    <span><span class="resaltado">Dockerfile: </span> Archivo de texto plano que contiene un conjunto de instrucciones para construir un contenedor.</span><br/>
                    <span><span class="resaltado">dockerfile -> docker build</span>    ====    <span class="resaltado">makefile -> drush make</span></span></span><br/>
                    <br/>
                    <strong>Qué necesitamos?</strong><br/>
                    <ul>
                        <li>Carpeta del proyecto.</li>
                        <li>Archivo <span class="resaltado">Dockerfile</span>.</li>
                        <li>Construir: <span class="resaltado">docker build</span>.</li>
                    </ul>
                    <br/>
                    <span>Ejemplos de Dockerfile: <span class="resaltado">github, github y github.</span></span><br/>
                    <a target="_blank" href="https://docs.docker.com/engine/reference/builder/">docs.docker.com/engine/reference/builder</a>

                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Demo 3

                        `Dockerfile`

                        ```
                        FROM drupal:7

                        # Install drush by using composer
                        ENV COMPOSER_HOME /root/composer
                        ENV COMPOSER_VERSION master

                        RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \
                        && composer global require drush/drush:7.* \
                        && ln -sf $COMPOSER_HOME/vendor/bin/drush.php /usr/local/bin/drush \
                        && drush cache-clear drush
                        ```
                    </script>
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Demo 3

                        `docker-compose.yml`

                        ```
                        web:
                        build: .
                        links:
                        - db:db-server
                        ports:
                        - 8080:80
                        db:
                        image: mysql:5.6
                        environment:
                        - MYSQL_ROOT_PASSWORD=1234
                        - MYSQL_DATABASE=database
                        - MYSQL_USER=user
                        - MYSQL_PASSWORD=1234
                        ```
                    </script>
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Demo 3

                        Construimos los contenedores

                        ```
                        $ docker-compose build

                        $ docker images
                        ```

                        Creamos los contenedores

                        ```
                        $ docker-compose up -d
                        ```
                        Comprobamos que todo está en ejecución
                        ```
                        $ docker-compose ps

                        $ docker ps -a
                        ```
                    </script>
                </section>

                <!--<section data-background-video="video/demo3.mov">
                </section>-->

                <section>
                    <h2>Video</h2>
                    <a href="https://www.youtube.com/watch?v=3AeCVYdGwzM">Ver el video.</a>
                </section>

                <!-- Demo 4 -->

                <section data-markdown>
                    <script type="text/template">
                        ## Demo 4

                        `docker-compose.yml`

                        ```
                        web:
                            build: .
                            links:
                                - db:db-server
                            environment:
                                - VIRTUAL_HOST=test.introbay.com
                            volumes_from:
                                - web-stg
                            mem_limit: 512m
                            restart: always
                        web-stg:
                            build: .
                            entrypoint: echo "Data-only container for Drupal"
                            volumes:
                                - /var/www/html
                        db:
                            image: mysql:5.6
                            environment:
                                - MYSQL_ROOT_PASSWORD=1234
                                - MYSQL_DATABASE=database
                                - MYSQL_USER=user
                                - MYSQL_PASSWORD=1234
                            mem_limit: 1024m
                            restart: always
                        proxy:
                            image: jwilder/nginx-proxy
                            volumes:
                                - /var/run/docker.sock:/tmp/docker.sock:ro
                            ports:
                                - 8080:80
                            mem_limit: 256m
                            restart: always
                        ```
                    </script>
                </section>

                <!--<section data-background-video="video/demo4.mov">
                </section>-->

                <section>
                    <h2>Video</h2>
                    <a href="https://www.youtube.com/watch?v=HBR7zP1a4hA">Ver el video.</a>
                </section>

                <section>
                    <h2>Aplicaciones prácticas</h2>
                    <p>Dependiendo de tu perfil:</p>
                    <ul>
                        <li>DevOps</li>
                        <li>Desarrollador (back o front)</li>
                    </ul>
                </section>
                <section>
                    <h2>DevOps</h2>
                    <p>Es posible tener diferentes configuraciones dependiendo del entorno</p>
                    <ul>
                        <li>
                            Prod: Mínima configuración, foco en <strong>performance</strong>.
                        </li>
                        <li>
                            Pre-prod: Basado en la configuración de Prod. Se usa habitualmente para construir el entorno de integración.
                        </li>
                        <li>
                            Dev: Basado en Pre-prod, puede añadir herramientas útiles en desarrollo: xdebug, vim, sass compiler, etc.
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>DevOps</h2>
                    <p>Otras cosas que hacen la vida más fácil:</p>
                    <ul>
                        <li>
                            Distribución de imágenes cocinadas listas para usar en cada entorno.
                        </li>
                        <li>
                            Sistemas de integración continua.
                        </li>
                        <li>
                            Control de versiones sobre la configuración.
                        </li>
                        <li>
                            Eliminación del efecto “a mi me funciona”.
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>DevOps</h2>
                    <h3>Despliegues</h3>
                    <ul>
                        <li>
                            Las imágenes de nuestra aplicación son los <em>artifacts</em> que desplegamos
                        </li>
                        <li>
                            Worflow simple: generas una imagen, despliegas, post-scripts
                        </li>
                        <li>
                            Desplegar o actualizar una imagen nueva es simple y rápido:<br/>
                            docker-compose up -d
                        </li>
                        <li>
                            Gestionar actualizaciones y cambios de versión pasa por <em>construir la nueva imagen</em>
                            y cambiar un número en el docker-compose.yml
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>Dev (back & front)</h2>
                    <ul>
                        <li>Simplificación del workflow de trabajo.</li>
                        <li>Posibilidad de tener múltiples entornos en la misma máquina.</li>
                        <li>Cambiar entre proyectos es fácil.</li>
                        <li>Desarrollo y tests sobre entorno idéntico a producción.</li>
                    </ul>
                </section>
                <section>
                    <h2>Dev (back & front)</h2>
                    <h3>¿Cómo modifico mi código?</h3>
                    <p>Hay varias opciones.</p>
                    <ul>
                        <li>Entro en el contenedor, uso Vim, git, etc.</li>
                        <li>Mapeo el directorio donde está mi código y lo modifico desde el exterior. (=> permisos :-S).</li>
                        <li>Nuestra solución: contenedor extra con SSH y que usa el volumen de Drupal (sshfs).</li>
                    </ul>
                </section>

                <section>
                    <h2>A tener en cuenta...</h2>
                    <p>No confies en alguien que te diga que Docker es un camino de rosas.</p>
                </section>
                <section>
                    <h2>A tener en cuenta...</h2>
                    <p>Empieza desde abajo, déjate el balconing.</p>
                </section>
                <section>
                    <h2>A tener en cuenta...</h2>
                    <p>Cuidado con los trendy guys.</p>
                </section>
                <section>
                    <h2>A tener en cuenta...</h2>
                    <p>Hay más dockers en el mar.</p>
                    <p>Google, CoreOs, RancherOs, ...</p>
                </section>


                <section>
                    <h1>¿Preguntas?</h1>
                </section>

                <section>
                    <img src="imgs/logo-tag-centro-blanco.svg" style="width: 30%;box-shadow: none;border: none;">
                    <img src="imgs/logodevops.png" style="width: 34%;box-shadow: none;border: none;margin-left: 10%">
                    <div>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</div>
                    <br>
                    <h1>Gracias</h1>

                    <div>Ignacio López Flores</div>
                    <a href="https://twitter.com/ignaciolflores" target="_blank">@ignaciolflores</a>
                </section>


            </div>
        </div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: 'slide', // none/fade/slide/convex/concave/zoom


                // Parallax background image
                // parallaxBackgroundImage: 'imgs/bgdrupal.jpg', 
                // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

                // Parallax background size
                // parallaxBackgroundSize: '1920px 1080px', // CSS syntax, e.g. "2100px 900px"

                // Amount to move parallax background (horizontal and vertical) on slide change
                // Number, e.g. 100
                //parallaxBackgroundHorizontal: '',
                //parallaxBackgroundVertical: '',

                math: {
                    mathjax: 'http://cdn.mathjax.org/mathjax/latest/MathJax.js',
                    config: 'TeX-AMS_HTML-full' // See http://docs.mathjax.org/en/latest/config-files.html
                },
                // Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true },
				],
                keyboard: {
                  39: 'next',
                  37: 'prev',
                  27: 'next'
                }
			});

		</script>

	</body>
</html>
